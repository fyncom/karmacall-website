[[headers]]
    for = "/*"
    [headers.values]
        X-Robots-Tag = "index, follow"
        Access-Control-Allow-Origin = "*"
        Access-Control-Allow-Methods = "GET, POST, OPTIONS"
        Access-Control-Allow-Headers = "Origin, X-Requested-With, Content-Type, Accept"

# CORS headers for API requests
[[headers]]
  for = "/api/*"
  [headers.values]
    X-Robots-Tag = "index, follow"
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"
    Access-Control-Allow-Headers = "Origin, X-Requested-With, Content-Type, Accept"

[build.environment]
  NODE_VERSION = "18"

# Reverse proxy for PostHog to reduce ad-blocker interference
[[redirects]]
  from = "/ph/*"
  to = "https://us.i.posthog.com/:splat"
  status = 200
  force = true

# Speed up Gatsby builds by caching .cache/ and public/ between builds
[[plugins]]
package = "@netlify/plugin-gatsby"

# Run the link checker only on Deploy Previews to keep production builds fast
[context.deploy-preview]
  [[context.deploy-preview.plugins]]
  package = "netlify-plugin-checklinks"
    [context.deploy-preview.plugins.inputs]
    # Skip external links from failing the build
    skipPatterns = [
      "www.googletagmanager.com",
      "googletagmanager.com",
      "https://www.googletagmanager.com",
      "https://googletagmanager.com"
    ]
    # Don't throw error on missing service worker
    todoPatterns = ["sw.js"]
    checkExternal = false
